@import com.domain.wn8.ClanWn8
@import org.joda.time.LocalDate
@import org.joda.time.LocalTime
@import java.util.Date; var prevDate: org.joda.time.LocalDate = null; var currentDate: org.joda.time.LocalDate = null; var currentTime: String = null
@(clan: com.domain.presentation.model.ClanDetails)(implicit request: RequestHeader)

@main(clan.tag, request.session.get("user")) {
<table align="center">
    <tr>
        <td align="right">Clan:</td><td>@clan.name</td>
    </tr>
    <tr>
        <td align="right">Members:</td><td>@clan.members.size</td>
    </tr>
    <tr>
        <td align="right" >Average WN8:</td><td class="@com.domain.presentation.model.ColorHelper.wn8Color(clan.averageWn8)">@clan.averageWn8</td>
    </tr>
</table>

@if(clan.battles.size > 0) {
<div class="section">Upcoming battles</div>
    <table cellpadding="0" cellspacing="0" align="center">
        @if(clan.battles.size > 0) { <thead><th>Date&nbsp;</th><th>Attacker&nbsp;</th><th></th><th align="right">Defender&nbsp;</th></thead> }
        @for(battle <- clan.battles) {
        @(currentDate = LocalDate.fromDateFields(new Date(battle.date * 1000)))
        @(currentTime = LocalTime.fromDateFields(new Date(battle.date * 1000)).toString("HH:mm"))
        <tr>
            @if(prevDate == currentDate) {
            <td align="right">@currentTime&nbsp;</td>
            } else {
            <td align="right"><b>@currentDate</b> @currentTime&nbsp;</td>
            }
            @(prevDate = currentDate)
            <td>
                <a class="@com.domain.presentation.model.ColorHelper.wn8Color(ClanWn8.getClanCachedWn8(battle.attackerClanTag).getOrElse("0").toString)" href="@routes.ClanDetailsController.details(battle.attackerClanId)">@battle.attackerClanTag</a>&nbsp;
            </td>
            <td>vs</td>
            <td align="right">
                <a class="@com.domain.presentation.model.ColorHelper.wn8Color(ClanWn8.getClanCachedWn8(battle.defenderClanTag).getOrElse("0").toString)" href="@routes.ClanDetailsController.details(battle.defenderClanId)">@battle.defenderClanTag</a>&nbsp;
            </td>
        </tr>
        }
    </table>
}

<div class="section">Members</div>
<table class="members" cellpadding="0" cellspacing="0" align="center">
    <thead>
        <th>Name</th>
        <th>Role</th>
        <th>Battles</th>
        <th>Wn8</th>
    </thead>
    @for(member <- clan.members) {
    <tr>
        <td><a href="@routes.TankerDetailsController.details(member.name)">@member.name</a></td>
        <td>@member.role</td>
        <td align="right">@member.battles</td>
        <td align="right" class="bg_@com.domain.presentation.model.ColorHelper.wn8Color(member.wn8)">@{"%.2f".format(member.wn8)}</td>
    </tr>
    }
</table>

}
